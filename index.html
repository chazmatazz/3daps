<!-- Copyright Kate Starbird 2009 -->
<!--
Kate Starbird's 3DAPS system - Own Your Avatar!

This builds off Google's sample o3d code - towards an Avatar controller.
-->
<html>
<head>
    <title>Own Your Avatar!</title>
    <link rel="stylesheet" href="css/main.css" type="text/css" />
    <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1/themes/cupertino/jquery-ui.css" type="text/css" />
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1/jquery-ui.min.js"></script>
    <script src="o3d-webgl/base.js"></script>
    <script src="o3djs/base.js"></script>
    <script src="js/animation.js"></script>
    <script src="js/parser.js"></script>
    <script src="js/ui.js"></script>
    <script>
        var base_url = window.location.href.substring(0, window.location.href.length - window.location.search.length);

        var local_urls = {
            kate: "examples/kate.js",
            yoga: "examples/yoga.js"
        };

        var default_code = local_urls.kate;

        var first_run = true;
        function populate_dropdown(target, data) {
            for(var i = 0; i < data.length; i++) {
                $('<option />', {value: data[i], text: i, selected: (data[i] == default_code)}).appendTo(target);
            }
        }
        function load_code(url) {
            $.get(url, function(data) {
                $("textarea#textbox").val(data);
                if(first_run && qs["autorun"]) {
                    run_user_script();
                    first_run = false;
                }
            }, "html");
        }

        function autorun(example) {
            $("#share-url").html(base_url + "?autorun=1&example=" + example);
            $( "#dialog-message" ).dialog({
                modal: true,
                buttons: {
                    Ok: function() {
                        $( this ).dialog( "close" );
                    }
                }
            });

        }

        var qs = (function(a) {
            if (a == "") return {};
            var b = {};
            for (var i = 0; i < a.length; ++i)
            {
                var p=a[i].split('=');
                if (p.length != 2) continue;
                b[p[0]] = decodeURIComponent(p[1].replace(/\+/g, " "));
            }
            return b;
        })(window.location.search.substr(1).split('&'));

        function load_example() {
            load_code($("#example_list").val());
        }

        function share_example() {
            autorun($("#example_list option:selected").text());
        }

        window.onload = init;

        /**
         * Creates the client area.
         */
        function init() {
            populate_dropdown($("#example_list"), local_urls);
            if(local_urls.hasOwnProperty(qs["example"])) {
                load_code(local_urls[qs["example"]]);
            } else {
                load_code(default_code);
            }

            o3djs.webgl.makeClients(initStep2);
        }
    </script>
</head>
<body>
  <div id="o3d"></div>
  <div id="code">
    <form name="code_form">
    	<select id="example_list" name="example_list"></select>
    	<button onClick="load_example(); return false;">Load Example</button>
    	<button onClick="share_example(); return false;">Share Example</button>
    <textarea id="textbox" name="code_box" onkeydown="return catchTab(this,event)">
</textarea></form>
  <button onClick="run_user_script(); return false;">Run</button>
  <button onClick="stop_user_script(); return false;">Stop</button>
  <button onClick="reset_me(); return false;">Reset Me</button>
  </div>
  <div id="dialog-message" title="Share">
	<p>Share the following url:</p>
	<p id="share-url"></p>
</div>
</body>
</html>
